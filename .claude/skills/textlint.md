# textlint

記事ファイルに対してtextlintを実行し、日本語文章の品質をチェック・改善します。

## 実行フロー

### 1. 対象ファイルの特定

ユーザーの指定に応じて、以下の優先順位で対象ファイルを決定：

1. **ユーザー指定のファイル**: 明示的に指定されたファイルパスを使用
2. **変更されたファイル**: `git status --porcelain` で変更された記事ファイル（articles/_.md, books/\*\*/_.md）を検出
3. **最近編集したファイル**: `git log` で直近のコミットで変更された記事ファイルを確認
4. **全記事チェック**: 上記がない場合、ユーザーに確認後、全記事をチェック

### 2. textlintチェックの実行

```bash
# まず問題の有無を確認
pnpm run lint <ファイルパス>
```

結果を以下の形式で整理：

- ⚠️ **警告**: 推奨事項（スタイルガイドライン）
- ❌ **エラー**: 修正が必要な問題
- ✅ **成功**: 問題なし

### 3. 問題の分析と修正提案

エラーや警告がある場合：

1. **自動修正の試行**:

   ```bash
   # ドライランで修正内容を確認
   pnpm run lint:fix --dry-run <ファイルパス>
   ```

2. **修正内容の確認**:
   - 自動修正可能な項目をリストアップ
   - 手動修正が必要な項目を特定
   - 各問題について具体的な修正案を提示

3. **ユーザーへの確認**:
   - AskUserQuestion ツールを使用して修正適用の確認
   - 選択肢：「全て修正」「選択して修正」「修正しない」「詳細を見る」

### 4. 修正の適用

ユーザーの選択に応じて：

- **自動修正**: `pnpm run lint:fix <ファイルパス>` を実行
- **手動修正案の提示**: Edit ツールで具体的な修正を提案
- **部分修正**: 選択された項目のみ修正

### 5. 結果レポート

チェック完了後、以下の形式でサマリーを表示：

```
📝 textlint チェック結果
━━━━━━━━━━━━━━━━━━━━━━━━
対象ファイル: <ファイル数>
修正済み: <修正数>
残りの警告: <警告数>
━━━━━━━━━━━━━━━━━━━━━━━━

[詳細な結果...]
```

## エラー別の対処法

### よくある問題と解決策

| ルール                                 | 問題例                         | 自動修正 | 手動対応           |
| -------------------------------------- | ------------------------------ | -------- | ------------------ |
| `ja-space-between-half-and-full-width` | 半角と全角の間にスペースがない | ✅       | -                  |
| `no-doubled-joshi`                     | 助詞の連続                     | ❌       | 文章の再構成を提案 |
| `sentence-length`                      | 文が長すぎる                   | ❌       | 文の分割案を提示   |
| `ja-no-mixed-period`                   | 句読点の混在                   | ✅       | -                  |
| `no-synonyms`                          | 同義語の不統一                 | ⚠️       | 統一案を提示       |

## 注意事項

- **対象**: articles/ と books/ ディレクトリ配下のMarkdownファイルのみ
- **設定ファイル**: `.textlintrc` の設定に従う
- **辞書**: prh設定による表記統一ルールを適用
- **フィードバック**: 修正後も問題が残る場合は、ルール設定の見直しを提案
